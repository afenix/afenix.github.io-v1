<!doctype html>

<html lang="en">
	<head>
		<meta charset="utf-8">

	  	<title>North American Shared Print Collection</title>
	  	<link rel="stylesheet" type="text/css" href="../resources/mapStyle.css">
	  	<link href="https://fonts.googleapis.com/css?family=Lato|Titillium+Web:600|Dosis:400,700,800" rel="stylesheet">
	  	<link href='https://api.mapbox.com/mapbox-gl-js/v0.38.0/mapbox-gl.css' rel='stylesheet' />
	<!-- Latest compiled and minified Bootstarp CSS -->
	 	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
	  	<script src='https://api.mapbox.com/mapbox-gl-js/v0.38.0/mapbox-gl.js'></script>
	  	<script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>

	<!-- Optional Bootstarp theme -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

		  
		  <!--[if lt IE 9]>
		    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.js"></script>
		  <![endif]-->
	</head>

	<body>
		<div class="center-page-title">
			<img class='worldcat-logo' src="../resources/WorldCat_Logo.png" alt="WorldCat Logo">
			<h2 class='page-title'>North American Shared Retention Commitments</h2>	
		</div>
		

		<div class='intro-text-container'>
		  <div class='intro-text'>
		    <p id='overview-description'>Ten Group Projects now exist in North America with membership of over 130 academic institutions spanning thirteen U.S. states and five Canadian provinces.  
		    	Through a collaborative process of shared print strategies these institutions have been able to retain print collections of <strong>18.5 million</strong> title-holdings, with <strong>7.4 million</strong> of those 
		    	titles retained being distinct editions.</p>
		  </div>
		</div>

		
		
		<div id='map'></div>

		<div class='titles-legend'>
		    <h5>Titles Retained</h5>
		    <div><span id='circle1'></span><= 20k</div>   
		    <div><span id='circle2'></span></div>
		    <div><span id='circle3'></span></div>
		    <div><span id='circle4'></span></div>
		    <div class='align-us'><span id='circle5'></span> > 500k</div>
		</div>

		<div class='group-legend'>
	        <fieldset>
	            <label id="group-legend-title">Click on a Library Group Name to zoom in on that group, or the "Overview" button to see all groups:</label>
	            <div id="group-legend-elements">
	            </div>
	        </fieldset>
		</div>

		<div class='descriptive-text-container' style="display:none;">
		  <div class='descriptive-text'>
		    <h4 id='location-title'></h4>
		    <p id='location-description'></p>
		  <!--   <small>Text credit: <a target='_blank' href='#'>a.fenix</a></small> -->
		  </div>
		</div>


		<div class="banner" style="margin-top:5px">
			<div class="col-md-6 total-container"> 
<!-- 			    <h2 class="btn btn-warning btn-sm button-margin total-button pull-right">Learn More</h2> -->
				<h3 class='total-holdings-header'>Total titles retained: <strong> 18.5 million title-holdings</strong></h3>
			</div>
			<div class="col-md-6 distinct-container">
<!-- 				<h2 class="btn btn-warning btn-sm button-margin distinct-button pull-right">Learn More</h2> -->
				<h3 class='distinct-holdings-header'>Distinct titles retained:<strong> 7.5 million distinct holdings</strong></h3>
			</div>
		</div>
		
		<div class="col-md-12 search-box">
		  <h3>Search for Retained Titles</h3>
			<input type="text" id="myInput" onkeyup="myFunction()" placeholder="Search for titles..">
		</div>

		<div class="col-md-12 table-titles"> 
		  <div class="table-responsive">          
		  <table class="table">
		    <thead>
		      <tr>
		        <th>Title</th>
		      </tr>
		    </thead>
		    <tbody>
		      <tr class="align-us">
		        <td>The early government gazettes. -/[Victoria : Archives of British Columbia Historical Association, 1943] 
		        	<div class='spacer'>
				        <span id="east">EAST : 10</span>
				        <span id="wrlc">WRLC : 3</span>	        		
		        	</div>
		        </td>
		      </tr>
		       <tr>
		        <td>CIS US serial set index. --/pt.3 v.1
		        	<div class='spacer'>
				        <span id="east">EAST : 10</span>
				        <span id="wrlc">WRLC : 3</span>	        		
		        	</div>
		        </td>
		      </tr>
		       <tr>
		        <td>An enemy of the state : the life of Murray N. Rothbard / Justin Raimondo/Amherst, NY : Prometheus Books, 2000
					<div class='spacer'>
				        <span id="east">EAST : 10</span>
				        <span id="wrlc">WRLC : 3</span>	        		
		        	</div>
		        </td>
		      </tr>
		    </tbody>
		  </table>
		  </div>
		</div>





		<script>
			mapboxgl.accessToken = 'pk.eyJ1IjoiYWxpc3RlcmZ4IiwiYSI6ImNpcW80cnExOTAxZW9meW5uamNhdDIwcXcifQ.X8cJ7YP65MrR3bBq4a1rmQ';
			var map = new mapboxgl.Map({
					container: 'map',
					style: 'mapbox://styles/mapbox/light-v9', //hosted style id
				   	center: [-100.546875, 44.510218], // starting position
				    minzoom: 10,
				    maxzoom: 3,
				    zoom: 3 // starting zoom
				});

			var title = document.getElementById('location-title');
			var description = document.getElementById('location-description');

			var libraries = [{
			    "id": "1",
			    "title": "EAST",
			    "description": "The Eastern Academic Scholars' Trust (EAST) is a shared print initiative involving academic and research libraries in 11 states from Maine to Florida. EAST is focused on retaining unique, scarcely held and frequently used scholarly monographs and serials in support of scholarship, research and teaching. EAST currently has 59 members with a shared print collection of 16,573,071 million title holdings and 4,749,042 million title sets.  Due to their ongoing efforts for participating members to commit to retain agreed upon titles the EAST project has been able to retain a shared print collection of 5,746,636 title-holdings, with 1,760,944 million of those titles retained being distinct editions.",
			    "camera": {
			        center: [-73.520508, 42.186811],
			        zoom: 4,
			        bearing: 0,
			        pitch: 0
			    } 
			}, {
			    "id": "2",
			    "title": "MSCS",
			    "description": "The Maine Shared Collections Cooperative (MSCC) was founded by eight of Maine’s largest libraries, plus the state’s consortium, Maine InfoNet, together they have implemented a shared approach to the management of print collections in the state. Due to their ongoing efforts for participating members to make collaborative decisions MSCS has been able to retain a shared print collection of 1,408,737 title-holdings, with 302,601 thousand of those titles retained being distinct editions.",
			    "camera": {
			        center: [-69.2578131, 45.563583],
			        zoom: 6,
			        bearing: 0,
			        pitch: 0
			    }
			}, {
			    "id": "3",
			    "title": "CNY",
			    "description": "ConnectNY (CNY) is a consortium of 12 independent academic institutions in New York State. The mission of ConnectNY is to share collections, leverage resources, and enhance services through cooperative initiatives and coordinated activities. Due to their ongoing efforts for collaborative retention the CNY project has been able to retain a shared print collection of 852,205 thousand title-holdings to date.",
			    "camera": {
			        center: [-75.541992, 43.304694],
			        zoom: 4.7,
			        bearing: 0,
			        pitch: 0
			    }
			}, {
			    "id": "4",
			    "title": "VIVA",
			    "description": "The Virtual Library of Virginia (VIVA) is the consortium of nonprofit academic libraries within the Commonwealth of Virginia. These include six doctoral institutions and two 4-year comprehensive colleges and universities.  Due to their ongoing efforts for participating members to make collaborative decisions VIVA has been able to retain a shared print collection of 3,531,007 title-holdings, with 421,803 thousand of those titles retained being distinct editions.",
			    "camera": {
			        center: [-78.002930, 37.785639],
			        zoom: 5.3,
			        bearing: 0,
			        pitch: 0
			    }
			}, {
			    "id": "5",
			    "title": "WRLC",
			    "description": "The Washington Research Library Consortium (WRLC) was established as a non-profit corporation in 1987 to support and enhance the library and information services of universities in the Washington, DC metropolitan area. Currently WRLC has 9 partner universities.  Due to their ongoing efforts for participating members to make collaborative decisions WRLC has been able to retain a shared print collection of 2,862,344 title-holdings, with 437,841 thousand of those titles retained being distinct editions.",
			    "camera": {
			        center: [-77.053986, 38.932407],
			        zoom: 10,
			        bearing: 0,
			        pitch: 0
			    }
		 	}, {
			    "id": "6",
			    "title": "TUG",
			    "description": "The TriUniversity Group of Libraries (TUG) is a unique example of administrative co-operation among the Libraries of three Ontario universities: University of Guelph, Universtiy of Waterloo, and the Wilfred Laurier University.  The TUG libraries have been informally collaborating for nearly thirty years; however more recently, they have enhanced their co-operation with a more formalised agreement to work together to leverage rapidly-advancing technologies for mutual benefit. Because of their shared committment TUG has now been able to retain 340,279 thousand title-holdings, with 20,396 thousand of those titles retained being distinct editions.",
			    "camera": {
			        center: [-80.362244, 43.488237],
			        zoom: 7,
			        bearing: 0,
			        pitch: 0
			    }
			}, {
			    "id": "7",
			    "title": "MI-SPI",
			    "description": "In 2011, the libraries at Michigan's publicly-supported universities sought to devise a collaborative approach to shared print collections among themselves, calling themselves the Michigan Shared Print Initiative (MI-SPI). Participating libraries used services and tools developed by Sustainable Collection Services (SCS) to identify such titles in their respective individual collections, and to compare results across the group. Eleven universities participated in this endeavor across Michigan state, allowing participating members to retain 774,173 thousand title-holdings, with 79,227 thousand of those titles retained being distinct editions.  ",
			    "camera": {
			        center: [-85.869141, 44.382275],
			        zoom: 4.5,
			        bearing: 0,
			        pitch: 0
			    } 
			}, {
			    "id": "8",
			    "title": "ALI Project",
			    "description": "The mission of Academic Libraries of Indiana (ALI) is to build and foster community and collaboration among academic libraries in Indiana. ALI is a consortium of 37 participating libraries with a shared print collection of 5,512,435 million title holdings and 2,287,041 million title sets.  Due to their ongoing efforts for a state-wide academic library collaboration, the ALI project has been able to retain a shared print collection of 1,701,374 title-holdings, with 370,490 thousand of those titles retained being distinct editions.", 
			    "camera": {
			        center: [-86.220703, 39.921849],
			        zoom: 4.5,
			        bearing: 0,
			        pitch: 0
			    }
			}, {
			    "id": "9",
			    "title": "CI-CCI",
			    "description": "The formation of the Central Iowa Collaborative Collections Initiative (CI-CCI) was announced in the summer of 2013, with an initial membership of 5 universities in the state.  By working together the CI-CCI group has been able to meet their goals of decreasing the size of local print collections by reducing duplication among the participating libraries and creating and maintaining a distributed, shared collection of these titles to ensure that circulating copies of them are retained within the group. Because of this CI-CCI has been able to retain 152,553 thousand title-holdings, with 741 of those titles retained being distinct editions.",
			    "camera": {
			        center: [-93.449707, 41.339185],
			        zoom: 6,
			        bearing: 0,
			        pitch: 0
			    }
			}, {
			    "id": "10",
			    "title": "COPPUL",
			    "description": "Working together, the Council of Prairie and Pacific University Libraries (COPPUL) members leverage their collective expertise, resources, and influence, increasing capacity and infrastructure, to enhance learning, teaching, student experiences, and research amongst their institutions. The consortium is comprised of 22 university libraries located in Manitoba, Saskatchewan, Alberta and British Columbia with a shared print collection of 7,276,328 million title holdings and 3,738,751 million title sets.  Due to their ongoing efforts for collective retention strategies COPPUL has been able to retain a shared print collection of 1,147,232 milliion title-holdings, with 778,071 thousand of those titles retained being distinct editions.",
			    "camera": {
			        center: [-110.039063, 49.999795],
			        zoom: 4.5,
			        bearing: 0,
			        pitch: 0
			    }
			 }, {
			 	"id": "11",
			    "title": "",
			    "description": "",
			    "camera": {
			        center: [-100.546875, 44.510218],
			        zoom: 3,
			        bearing: 0,
			        pitch: 0
			    }
			}];

			function highlightGroup(group_name) {
			    // Only show the point features that coorespond to `group` in the data
			    map.setFilter('shared_collection', ["==", 'group', group_name]);
			}

			function highlightAll(overview) {
				// TODO: come up with a more elegant solution for nulling out the setFilter 
			    map.setFilter('shared_collection', ["==", 'overview', overview]);
			}

			function playback(index) {
			    title.textContent = libraries[index].title;
			    description.textContent = libraries[index].description;
			    if (libraries[index].title != "Overview") {
				    highlightGroup(libraries[index].id ? libraries[index].title : '');		    	
			    } else {
			    	highlightAll(1);	
			    }

			    // Animate the map position based on camera properties
			    map.flyTo(libraries[index].camera);

			    map.once('moveend', function() {
			        // Duration the slide is on screen after interaction
			        window.setTimeout(function() {
			            // Increment index
			            index = (index + 1 === libraries.length) ? 0 : index + 1;
			            playback(index);
			        }, 5000); // After callback, show the location for 5 seconds.
			    });
			}

			// Display the last title/description first
			title.textContent = libraries[libraries.length - 1].title;
			description.textContent = libraries[libraries.length - 1].description;

			 map.on('load', function () {
		         map.addLayer({
		            'id': 'shared_collection',
		            'type': 'circle',
		            //Load the vector tile source from mapbox
		            'source': {
		                type: 'vector',
		                url: 'mapbox://alisterfx.aa1m7nfd' //Your Mapbox tileset Map ID
		            },
		            'source-layer': 'Shared_Print_Retentions_by_Li-2ub8zq', //name of tileset
		            'paint' : {
		                'circle-radius' : {
		                	property: 'total_count_num',
				            type: 'interval',
				            stops: [ 
			                    [20000, 5],
			                    [100000, 7.5],
			                    [200000, 10],
			                    [500000, 13.5],
			                    [1408737, 17]
			                ]
		                },
		                'circle-color': {
			                property: 'group',
			                type: 'categorical',
			                stops: [
			                    ['ALI', '#A6CEE3'],
			                    ['CI-CCI', '#1F78B4'],
			                    ['CNY', '#B2DF8A'],
			                    ['COPPUL', '#33A02C'],
			                    ['EAST', '#FB9A99'],
			                    ['MI-SPI', '#E31A1C'],
			                    ['MSCS', '#FDBF6F'],
			                    ['TUG', '#FF7F00'],
			                    ['VIVA', '#CAB2D6'],
			                    ['WRLC', '#6A3D9A']]
			            },
		                'circle-opacity' : 0.55
		              },
		        });
		    });

			$( "h2.total-button" ).click(function() {
				playback(0);
			});

			// add nav features to the map
			map.addControl(new mapboxgl.NavigationControl({position: 'top-left'}));


			// Create a popup object, but don't add it to the map yet.
		    var popup = new mapboxgl.Popup({
		        closeButton: false,
		        closeOnClick: false
		    });

		    // add a info popup to map on hover 
			map.on('mouseenter', 'shared_collection', function(e) {
			    // Change the cursor style as a UI indicator.
			    map.getCanvas().style.cursor = 'pointer';

			    var features = map.queryRenderedFeatures(e.point, { layers: ['shared_collection'] });
			     // if the features has no info, return nothing
			    if (!features.length) {
			        return;
			    }
			    var feature = features[0];			        
			    // Populate the popup and set its coordinates
			    // based on the feature found.
			    popup.setLngLat(feature.geometry.coordinates)
			         .setHTML('<div id="popup" class="popup" style="z-index: 10;"> <h5 style="text-align:center"> ' + feature.properties['group'] + ' Group</h5><h5 style="margin-left:15px;"><strong>' + feature.properties['inst_name'] + '</strong></h5>' +
				              '<ul class="list">' +
				              '<li class="list-total-retentions"> Total titles retained: ' + feature.properties['total_count_string'] + ' </li>' +
				              '<li class="list-distinct-retentions"> Total unique titles retained: ' + feature.properties['unique_count_string'] + " </li>" + '</ul> </div>')
			        .addTo(map);
			});

			map.on('mouseleave', 'shared_collection', function() {
			    map.getCanvas().style.cursor = '';
			    popup.remove();
			});

			// Add a clickable group legend to the map
			var group_legend_elements = document.getElementById('group-legend-elements');
			var group_info = [
				{
			    	"group_name": "EAST",
			        "group_color": "#FB9A99",
			        "group_count": "5.75M"
			    },
			    {
			    	"group_name": "MSCS",
			        "group_color": "#FDBF6F",
			        "group_count": "1.4M"
			    },
			    {
			     	"group_name": "CNY",
			        "group_color": "#B2DF8A",
			        "group_count": "850K"
			    },
			    {
			     	"group_name": "VIVA",
			        "group_color": "#CAB2D6",
			        "group_count": "3.5M"
			    },
			    {
			     	"group_name": "WRLC",
			        "group_color": "#6A3D9A",
			        "group_count": "2.9M"
			    },
			    {
			     	"group_name": "TUG",
			        "group_color": "#FF7F00",
			        "group_count": "340K"
			    },
			    {
			     	"group_name": "MI-SPI",
			        "group_color": "#E31A1C",
			        "group_count": "774K"
			    },
			    {
			     	"group_name": "ALI",
			        "group_color": "#A6CEE3",
			        "group_count": "1.7M"
			    },
			    {
			     	"group_name": "CI-CCI",
			        "group_color": "#1F78B4",
			        "group_count": "153K"
			    },
			    {
			     	"group_name": "COPPUL",
			        "group_color": "#33A02C",
			        "group_count": "1.14M"
			    },
			    {
			    	"group_name": "Overview",
			        "group_color": "#666666",
			        "group_count": "18.5M"
			    }
			];

			$.each(group_info, function(key, obj) {
				var group_div = document.createElement('div');
			    $(group_div).addClass('group_div');
			    var group_button = document.createElement('button');
			    $(group_button).addClass('btn btn-xs');
			    var group_count = document.createElement('h6');
			     $(group_count).addClass('group_count');

			    $.each(obj, function(key, value) {
			    	if (key === 'group_name') {
				    	$(group_div).text(value);
			    	} else if (key === 'group_count') {
				    	$(group_count).text(value);
			    	} else {
				    	group_button.style.backgroundColor = value;
			    	}
			    	group_div.style.position = 'relative';
					group_div.style.display = 'inline-block';
					group_button.style.display = 'inline-block';
				    group_button.style.margin = '0px 35px 25px 0px';
				    group_div.style.color = '#666666';
				});

			    group_div.addEventListener('click', function() {
			        if (libraries[key].title != "") {
				        $('.descriptive-text-container').animate({
				        }, 750, function() {
				            $('.descriptive-text-container').show();
				        });
			        } else if (libraries[key].title === "") {
			        	$('.descriptive-text-container').animate({
				        }, 750, function() {
				            $('.descriptive-text-container').hide();
				        });
			        }
			       

			        map.flyTo(libraries[key].camera);
			        if (libraries[key].title != 'Overview') {
				        title.textContent = libraries[key].title;
				    	description.textContent = libraries[key].description; 	
			        } else {
			        	title.textContent = '';
				    	description.textContent = ''; 	
			        }
			    });
			    group_legend_elements.appendChild(group_div);
			 	group_div.appendChild(group_count);
			 	group_div.appendChild(group_button);
			});


		</script>
	<!-- Latest compiled and minified Bootstrap JavaScript -->
<!-- 		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
 -->
	</body>
</html>
